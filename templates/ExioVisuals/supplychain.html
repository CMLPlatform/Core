<!DOCTYPE html>
{% extends 'ExioVisuals/base.html' %}
{% load static %}

{% block speciality %}
<link href="{% static 'fancytree/skin-bootstrap-n/ui.fancytree.css' %}" rel="stylesheet" type="text/css"
    class="skinswitcher">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.2/js.cookie.min.js"></script>
  <script src="{% static 'fancytree/src/jquery.fancytree.js' %}" type="text/javascript"></script>

  <script src="{% static 'fancytree/src/jquery.fancytree.persist.js' %}" type="text/javascript"></script>
  <script src="{% static 'fancytree/src/jquery.fancytree.dnd.js' %}" type="text/javascript"></script>
  <script src="{% static 'fancytree/src/jquery.fancytree.edit.js' %}" type="text/javascript"></script>
  <script src="{% static 'fancytree/src/jquery.fancytree.glyph.js' %}" type="text/javascript"></script>
  <script src="{% static 'fancytree/src/jquery.fancytree.table.js' %}" type="text/javascript"></script>
  <script src="{% static 'fancytree/src/jquery.fancytree.wide.js' %}" type="text/javascript"></script>
  <script src="{% static 'fancytree/src/jquery.fancytree.childcounter.js' %}" type="text/javascript"></script>
 <script src="{% static 'fancytree/src/jquery.fancytree.filter.js' %}" type="text/javascript"></script>

 <script src="//d3plus.org/js/d3.js"></script>
<script src="//d3plus.org/js/d3plus.js"></script>



    <script src="{% static 'js/sankey.js' %}" type="text/javascript"></script>
<!-- Add code to initialize the product tree when the document is loaded: -->
{% include "ExioVisuals/myFancyTrees.html" %}
<!--popup functionality-->
{% if popup %}
<script type="text/javascript">


 $(window).load(function(){
        $('#myModal').modal('show');
    });

</script>
{% endif %}
{% endblock %}
{% block navibar %}

 <li class="active" ><a href="../distribution" >

  <span class="glyphicon glyphicon-scale" aria-hidden="true" > PieChart  </span></a>
</li>

          <li class="active"><a href="../timeseries" >

  <span class="glyphicon glyphicon-time" aria-hidden="true" > TimeSeries</span></a>
</li>

           <li class="active"><a href="../geo">
  <span class="glyphicon glyphicon-globe" aria-hidden="true" >  GeoRegion</u></span></a>
</li>

<li class="active2"><a href="../supplychain"style="color: #428bca;">
  <span class="glyphicon glyphicon-link" aria-hidden="true" > SupplyChain</span></a>
</li>

          <li class="active"><a href="../treemap">

  <span class="glyphicon glyphicon-leaf" aria-hidden="true" > TreeMap</span></a>
</li>


<li class="active"><a href="../about">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" > About</span></a>
</li>
{% endblock %}
{% block title %}
SupplyChain
{% endblock %}
{% block body_block %}
<script>

{%  if session == "RESET" %}

setTimeout(function(){
console.log("called");
var tree = $("#tree").fancytree("getTree");
       var tree6 = $("#tree6").fancytree("getTree");
       var tree7 = $("#tree7").fancytree("getTree");
       var tree3 = $("#tree3").fancytree("getTree");
       var tree2 = $("#tree2").fancytree("getTree");
       var tree4 = $("#tree4").fancytree("getTree");

         tree.clearCookies();
         tree6.clearCookies();
         tree7.clearCookies();
         tree3.clearCookies();
         tree2.clearCookies();tree4.clearCookies();

      $("#tree").fancytree("getTree").visit(function(node){
          node.setSelected(false);
      });
      $("#tree6").fancytree("getTree").visit(function(node){
          node.setSelected(false);
      });
      $("#tree7").fancytree("getTree").visit(function(node){
          node.setSelected(false);
      });
      $("#tree3").fancytree("getTree").visit(function(node){
          node.setSelected(false);
      });
      $("#tree2").fancytree("getTree").visit(function(node){
          node.setSelected(false);
      });
      $("#tree4").fancytree("getTree").visit(function(node){
          node.setSelected(false);
      });
}, 2000);


{% endif %}

</script>



  <div class="row">
    <div class="thumbnail">
         <div class="caption">

         <div class="caption" ALIGN=justify>
      <h3 ALIGN=center>{{title}}</h3>
             {% if  title %}
        <p> <p><center>Plotted in kgCO2eq</center></p>
{% endif %}
        </p>{% if not title %}{{desc|safe}}{% endif %}

         </div>

  </div>
    </div>
    </div>

<center>
<p id="chart"></p>
</center>

   {% if not desc %}
<div class="row">
    <div class="thumbnail">
         <div class="caption">

         <div class="caption" ALIGN=justify>
    <center>
        {% if not default %}
            <h4>Export<span class="glyphicon glyphicon-export" aria-hidden="true" ></span><br></h4>

<form method="post"> {% csrf_token %}
    <input type="hidden" name="raw" value="{{dataExport}}">

        <input type="submit" class="btn btn-primary btn-xs" value="Export raw data (CSV)">
    </form>
{% endif %}

<!--
<canvas id="canvas2" width="1000" height="1000" style="display:none">   </canvas>
<body onload="myFunction()"></body>
-->
</center>
</div></div></div></div>{% endif %}



 {{description|safe}}



<!--If there are forms from the reload, show a pop-up-->
<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
          <center>
        <h4 class="modal-title">ExioVisuals</h4></center>
      </div>
      <div class="modal-body">
        <p>Your filter interface has been updated according to your input.</p>
          You selected the following decomposition:<br> <strong>{{userSelectMode}}</strong>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>




<style>

#chart {
  height: 500px;
}

.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}

.node text {
  pointer-events: none;
  text-shadow: 0 1px 0 #fff;
}

.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}


.cycleLink {
  fill: none;
  stroke: #300;
  stroke-opacity: .2;
}

.cycleLink:hover {
  stroke-opacity: .5;
}

.link:hover {
  stroke-opacity: .5;
}

</style>
</head>



<script>
 {% if  title %}
var margin = {top: 1, right: 1, bottom: 6, left: 1},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var formatNumber = d3.format(",.0f"),
    format = function(d) { return formatNumber(d) + " kgCo2eq"; },
    color = d3.scale.category20();

var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var sankey = d3.sankey()
    .nodeWidth(15)
    .nodePadding(10)
    .size([width, height]);

var path = sankey.link();

function createChart( energy ) {
  sankey
      .nodes(energy.nodes)
      .links(energy.links)
      .layout(32);

  var link = svg.append("g").selectAll(".link")
      .data(energy.links)
    .enter().append("path")
      .attr("class", function(d) { return (d.causesCycle ? "cycleLink" : "link") })
      .attr("d", path)
      .style("stroke-width", function(d) { return Math.max(1, d.dy); })
      .sort(function(a, b) { return b.dy - a.dy; });

  link.append("title")
      .text(function(d) { return d.source.name + " -> " + d.target.name + "\n" + format(d.value); });

  var node = svg.append("g").selectAll(".node")
      .data(energy.nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    .call(d3.behavior.drag()
      .origin(function(d) { return d; })
      .on("dragstart", function() { this.parentNode.appendChild(this); })
      .on("drag", dragmove));

  node.append("rect")
      .attr("height", function(d) { return d.dy; })
      .attr("width", sankey.nodeWidth())
      .style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
      .style("stroke", function(d) { return d3.rgb(d.color).darker(2); })
    .append("title")
      .text(function(d) { return d.name + "\n" + format(d.value); });

  node.append("text")
      .attr("x", -6)
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "end")
      .attr("transform", null)
      .text(function(d) { return d.name; })
    .filter(function(d) { return d.x < width / 2; })
      .attr("x", 6 + sankey.nodeWidth())
      .attr("text-anchor", "start");

  function dragmove(d) {
    d3.select(this).attr("transform", "translate(" + d.x + "," + (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) + ")");
    sankey.relayout();
    link.attr("d", path);
  }
  
};


var energyData = {"nodes":{{nodes|safe}},
"links":{{links|safe}}}

createChart( energyData )
{% endif %}
</script>

{% endblock %}


{% block modeForms %}

<div class="panel-body"  style="background-color:white;font-size: 12px;">

<legend>Decomposition</legend>

<form class="form-inline" method="post" action="../supplychain/">
     {% csrf_token %}

<fieldset class="inlineLabels">
     <strong>From</strong> {{ leftMode }}
    {{ leftMode.get_FIELDNAME_display }}
</fieldset>
    <fieldset class="inlineLabels">
         <strong>To</strong>{{ rightMode }}
        </fieldset>
<center>
     <button id="reload" class="btn btn-lg btn-primary btn-sm" type="submit">Reload</button></center>
 </form>
   </div>
                  {% endblock %}


{% block formType %}
<form  method="post" action="../supplychain/"> {% csrf_token %}
    {% endblock %}
{% block body3 %}
<!--Send the mode in this block (no specific reason-->
<input type="hidden" name="selectMode" value="{{ userSelectMode }}" >

Select pressures  for analysis:
 <center>




            <br>

            <div class="btn-group" role="group" aria-label="...">
                <button  type="button" id="btnsFocus5" class="btn btn-primary btn-sm">Select below</button>

                <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsSelectAll5">Select shown</button>
    <button type="button" id="btnsExpandAll5" class="btn btn-primary btn-sm" onclick="upCount();">Expand</button>
                                      <button  type="button" id="btnsCollapseLevel5" class="btn btn-primary btn-sm">Collapse</button>

                <button type="button" class="btn btn-primary btn-sm" href="#" id="btnsDeselectAll5">Deselect all</button>
      <button  type="button" id="btnsCollapseAll5" class="btn btn-primary btn-sm">Collapse all</button>

      <button  type="button"  class="btn btn-primary btn-sm" style="background: transparent;border: none !important;
    font-size:0;">Collapse all</button>
 <li class="active"><a href="../infobutton">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" > Info</span></a>
</li>
            </div>
                <br>




       <p>
</center>


		<div id="tree5" class="panel-body fancytree-colorize-hover fancytree-fade-expander">

        </div>

<!--
<form class="form-signin" method="POST" id="MyForm" name="MyForm">

    {% csrf_token %}
    <input type="radio"  name="groupss" value="mode1" id="s"> Mode1<br>
<input type="radio"  name="groupss" value="mode2" id="k" checked> Mode2<br>

<hr>


     <button id="reload" class="btn btn-lg btn-primary btn-block" type="submit">Reload</button>
 </form>

-->


{% endblock %}


{% block body4 %}
    Select years  for analysis:
{{warning_11|safe}}
<br>
    <center>
         <div class="btn-group" role="group" aria-label="...">
                    <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsSelectAll7">Select all</button>
                    <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsDeselectAll7">Deselect all</button>
                    <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsCollapseAll7">Collapse all</button>

    </div></center>
<div id="tree7" class="panel-body fancytree-colorize-hover fancytree-fade-expander">

        </div>



 {% endblock %}
{% block body5 %}
{{warning_5|safe}}
Select countries  for analysis:
 <center>





            <br>

            <div class="btn-group" role="group" aria-label="...">
                <button  type="button" id="btnsFocus2" class="btn btn-primary btn-sm">Select below</button>

                <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsSelectAll2">Select shown</button>
    <button type="button" id="btnsExpandAll2" class="btn btn-primary btn-sm" onclick="upCount();">Expand</button>
                                      <button  type="button" id="btnsCollapseLevel2" class="btn btn-primary btn-sm">Collapse</button>

                <button type="button" class="btn btn-primary btn-sm" href="#" id="btnsDeselectAll2">Deselect all</button>
      <button  type="button" id="btnsCollapseAll2" class="btn btn-primary btn-sm">Collapse all</button>

      <button  type="button"  class="btn btn-primary btn-sm" style="background: transparent;border: none !important;
    font-size:0;">Collapse all</button>
 <li class="active"><a href="../infobutton">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" > Info</span></a>
</li>
            </div>
                <br>




       <p>
</center>


		<div id="tree2" class="panel-body fancytree-colorize-hover fancytree-fade-expander">

        </div>


 {% endblock %}

{% block body10 %}
{{warning_10|safe}}
Select countries  for analysis:
 <center>




            <br>
  <div class="btn-group" role="group" aria-label="...">
                <button  type="button" id="btnsFocus6" class="btn btn-primary btn-sm">Select below</button>

                <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsSelectAll6">Select shown</button>
    <button type="button" id="btnsExpandAll6" class="btn btn-primary btn-sm" onclick="upCount();">Expand</button>
                                      <button  type="button" id="btnsCollapseLevel6" class="btn btn-primary btn-sm">Collapse</button>

                <button type="button" class="btn btn-primary btn-sm" href="#" id="btnsDeselectAll6">Deselect all</button>
      <button  type="button" id="btnsCollapseAll6" class="btn btn-primary btn-sm">Collapse all</button>

      <button  type="button"  class="btn btn-primary btn-sm" style="background: transparent;border: none !important;
    font-size:0;">Collapse all</button>
 <li class="active"><a href="../infobutton">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" > Info</span></a>
</li>
            </div>
                <br>




       <p>
</center>


		<div id="tree6" class="panel-body fancytree-colorize-hover fancytree-fade-expander">

        </div>


 {% endblock %}

{% block body6 %}
{{warning_6|safe}}
Select products for analysis:

    <center>



            <br>

            <div class="btn-group" role="group" aria-label="...">
                <button  type="button" id="btnsFocus" class="btn btn-primary btn-sm">Select below</button>

                <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsSelectAll">Select shown</button>
    <button type="button" id="btnsExpandAll" class="btn btn-primary btn-sm" onclick="upCount();">Expand</button>
                                      <button  type="button" id="btnsCollapseLevel" class="btn btn-primary btn-sm">Collapse</button>

                <button type="button" class="btn btn-primary btn-sm" href="#" id="btnsDeselectAll">Deselect all</button>
      <button  type="button" id="btnsCollapseAll" class="btn btn-primary btn-sm">Collapse all</button>

      <button  type="button"  class="btn btn-primary btn-sm" style="background: transparent;border: none !important;
    font-size:0;">Collapse all</button>
 <li class="active"><a href="../infobutton">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" > Info</span></a>
</li>
            </div>
                <br>




       <p>
                    <br>
		<label>Search products:</label>
		<input name="search" placeholder="Products..." autocomplete="off" >
		<button id="btnResetSearch" hidden="hidden">&times;</button>
		<span id="matches"></span>
	</p>



       <p>
</center>


		<div id="tree" class="panel-body fancytree-colorize-hover fancytree-fade-expander">

        </div>







    {% endblock %}

{% block body7 %}

{{warning_7|safe}}
Select countries for analysis:

<center>



            <br>

            <div class="btn-group" role="group" aria-label="...">
                <button  type="button" id="btnsFocus3" class="btn btn-primary btn-sm">Select below</button>

                <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsSelectAll3">Select shown</button>
    <button type="button" id="btnsExpandAll3" class="btn btn-primary btn-sm" onclick="upCount();">Expand</button>
                                      <button  type="button" id="btnsCollapseLevel3" class="btn btn-primary btn-sm">Collapse</button>

                <button type="button" class="btn btn-primary btn-sm" href="#" id="btnsDeselectAll3">Deselect all</button>
      <button  type="button" id="btnsCollapseAll3" class="btn btn-primary btn-sm">Collapse all</button>

      <button  type="button"  class="btn btn-primary btn-sm" style="background: transparent;border: none !important;
    font-size:0;">Collapse all</button>
 <li class="active"><a href="../infobutton">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" > Info</span></a>
</li>
            </div>
                <br>




       <p>
</center>


		<div id="tree3" class="panel-body fancytree-colorize-hover fancytree-fade-expander">

        </div>














<!--

            <center>
			<h3>Countries</h3>
                <hr>
            <br>

            <div class="btn-group" role="group" aria-label="...">
  <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsSelectAll2">Select all</button>
  <button type="button" class="btn btn-primary btn-sm" href="#" id="btnsDeselectAll2">Deselect all</button>
    <button type="button" id="btnsExpandAll2" class="btn btn-primary btn-sm">Expand all</button>
      <button  type="button" id="btnsCollapseAll2" class="btn btn-primary btn-sm">Collapse all</button>
      <button  type="button"  class="btn btn-primary btn-sm" style="background: transparent;border: none !important;
    font-size:0;">Collapse all</button></div>
                <br>
                <p>
                    <br>

	</p>



       <p>
</center>


		<div id="tree2" class="panel-body fancytree-colorize-hover fancytree-fade-expander">

        </div>


-->

<center>

{% endblock %}

{% block body8 %}
   {{warning_8|safe}}
   Select products for analysis:
<center>


            <br>

           <div class="btn-group" role="group" aria-label="...">
                <button  type="button" id="btnsFocus4" class="btn btn-primary btn-sm">Select below</button>

                <button type="button" class="btn btn-primary btn-sm"href="#" id="btnsSelectAll4">Select shown</button>
    <button type="button" id="btnsExpandAll4" class="btn btn-primary btn-sm" onclick="upCount();">Expand</button>
                                      <button  type="button" id="btnsCollapseLevel4" class="btn btn-primary btn-sm">Collapse</button>

                <button type="button" class="btn btn-primary btn-sm" href="#" id="btnsDeselectAll4">Deselect all</button>
      <button  type="button" id="btnsCollapseAll4" class="btn btn-primary btn-sm">Collapse all</button>

      <button  type="button"  class="btn btn-primary btn-sm" style="background: transparent;border: none !important;
    font-size:0;">Collapse all</button>
 <li class="active"><a href="../infobutton">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" > Info</span></a>
</li>
            </div>
                <br>




       <p>
</center>


		<div id="tree4" class="panel-body fancytree-colorize-hover fancytree-fade-expander">

        </div>

{% endblock %}

{% block belowButtons %}
{%  if session == "session" %}
    <button type="submit" class="btn btn-success btn-sm" value="Send data">Visualize in session</button>
    <input type="hidden" name="session" value="session" >
    <button type="submit" id="noSession2" class="btn btn-warning btn-sm" value="Send data">Visualize & reset session</button>

    <!--send hidden data for setting session on!-->
{% else %}
<button type="submit" id="noSession" class="btn btn-primary btn-sm" value="Send data">Visualize current & start new session</button></p></center>
    <!--Clear any cookie! by setting the id on clearcookie function-->
        {% endif %}
    </form>

 {% endblock %}
